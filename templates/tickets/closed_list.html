{% extends "layout.html" %}
{% block title %}Chamados Finalizados · Sollus{% endblock %}

{% block content %}
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
    <strong>Chamados Finalizados</strong>
    <a class="btn btn-sm btn-outline-primary" href="{{ url_for('tickets.reports_overview') }}">
      <i class="bi bi-bar-chart"></i> Relatórios
    </a>
  </div>

  <div class="card-body">
    {% if tickets and tickets|length %}
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>Título</th>
              <th>Solicitante</th>
              <th>Atribuído a</th>
              <th>Prioridade</th>
              <th>Criado em</th>
              <th class="text-end">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for t in tickets %}
              <tr>
                <td>{{ t.id }}</td>
                <td class="text-truncate" style="max-width: 320px;">
                  <a href="{{ url_for('tickets.ticket_detail', ticket_id=t.id) }}">{{ t.title }}</a>
                </td>
                <td>{{ t.user.name or t.user.email if t.user else '—' }}</td>
                <td>
                  {% if t.assignee %}
                    {{ t.assignee.name or t.assignee.email }}
                  {% else %}
                    —
                  {% endif %}
                </td>
                <td>
                  {% set pr = (t.priority or '').lower() %}
                  {% set badge = 'secondary' %}
                  {% if pr == 'high' %}
                    {% set badge = 'danger' %}
                  {% elif pr == 'medium' %}
                    {% set badge = 'primary' %}
                  {% elif pr == 'urgent' %}
                    {% set badge = 'dark' %}
                  {% endif %}
                  <span class="badge text-bg-{{ badge }}">
                    {% if pr == 'low' %}Baixa
                    {% elif pr == 'medium' %}Média
                    {% elif pr == 'high' %}Alta
                    {% elif pr == 'urgent' %}Urgente
                    {% else %}—{% endif %}
                  </span>
                </td>
                <td>{{ t.created_at.strftime('%d/%m/%Y %H:%M') if t.created_at else '-' }}</td>
                <td class="text-end">
                  <a class="btn btn-sm btn-outline-secondary"
                     href="{{ url_for('tickets.ticket_detail', ticket_id=t.id) }}">
                    <i class="bi bi-eye"></i>
                  </a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-muted">Nenhum chamado finalizado ainda.</div>
    {% endif %}
  </div>

  <div class="card-footer d-flex justify-content-end">
    <a class="btn btn-outline-primary" href="{{ url_for('tickets.dashboard') }}">
      <i class="bi bi-arrow-left"></i> Voltar ao Dashboard
    </a>
  </div>
</div>
{% endblock %}
